<?phpnamespace BW\controllers;use BW\tools\blogpostdb;use BW\tools\blogcommentdb;use BW\tools\bloguserdb;class PostsController {    use FilterInputTrait;    protected $blogPostDatabase;    protected $blogUserDatabase;    protected $blogCommentDatabase;    protected $view;    public function __construct(bloguserdb $blogUserDatabase, blogpostdb $blogPostDatabase, blogcommentdb $blogCommentDatabase, View $view) {        // use dependency injection instead                $this->blogUserDatabase = $blogUserDatabase;        $this->blogPostDatabase = $blogPostDatabase;        $this->blogCommentDatabase = $blogCommentDatabase;        $this->view = $view;           }       public function index() {        $blogPostsList = $this->blogPostDatabase->getVisiblePosts();        foreach ($blogPostsList as $singleBlogPost) {            $blogUsersList[$singleBlogPost->postuserid] = $this->blogUserDatabase->getUserById($singleBlogPost->postuserid);        }        $this->view->setData("blogPostsList",$blogPostsList);        $this->view->setData("blogUsersList",$blogUsersList);                $this->view->setContentFile("views/posts/index.php");        $this->view->renderView();    }    public function show() {        if ($_SERVER['REQUEST_METHOD'] == 'POST') {            $result = $this->newcomment();            if (is_array($result)) {                $errorMessages = $result;                $this->view->setData("errorMessages",$errorMessages);            }        }        if (!isset($_GET['id'])) {            $this->error("No post id mentioned");            return;        }        $id = htmlspecialchars($_GET['id']);        $blogPost = $this->blogPostDatabase->getPost($id);        //print_r($bpost);        if (!$blogPost instanceof \BW\tools\blogpost) {            $this->error("Cannot find the post with id $id");            return;        }        $blogUser = $this->blogUserDatabase->getUserById($blogPost->postuserid);        $this->blogPostDatabase->updatePostRead($blogPost->postid);        $blogCommentsList = $this->blogCommentDatabase->getCommentsByPost($blogPost->postid);        $pageTitle = "Welcome to Articles By U --- $blogPost->posttitle";        $this->view->setData("pageTitle",$pageTitle);        $this->view->setData("blogPost",$blogPost);        $this->view->setData("blogUser",$blogUser);                $this->view->setData("blogCommentsList",$blogCommentsList);                        $this->view->setContentFile("views/posts/show.php");        $this->view->renderView();         }    public function error($errorMessage) {                $this->view->setData("errorMessage",$errorMessage);        $this->view->setContentFile("views/posts/error.php");        $this->view->renderView();            }    public function newcomment() {        //echo "new comment";        if (!($_SERVER['REQUEST_METHOD'] == 'POST')) {            return;        }        // so, the following lines get executed only, if the request method is post        $errorMessages = [];        $blogComment = new \BW\tools\blogcomment();        if (empty($_POST['txtcommentname'])) {            $errorMessages[] = "Please enter your name";        } else {            $blogComment->commentname = $this->filterInput($_POST['txtcommentname']);        }        if (empty($_POST['txtcommenttext'])) {            $errorMessages[] = "Please enter your comment";        } else {            $blogComment->commenttext = $this->filterInput($_POST['txtcommenttext']);        }        if (empty($_POST['txtcommentpostid'])) {            $errorMessages[] = "Please enter your comment post id";        } else {            $blogComment->commentpostid = $this->filterInput($_POST['txtcommentpostid']);        }        if (!empty($errorMessages)) {            return $errorMessages;        }        // so , the following lines get executed only if errormsgs is empty, i.e there are no errors        $blogComment->commentdate = time();        $blogComment->commentisvisible = 1;        $result = $this->blogCommentDatabase->addComment($blogComment);        return $result;    }    public function search() {                if ($_SERVER['REQUEST_METHOD'] == 'POST') {            $searchtext = '';            if (!empty($_POST['txtsearch'])) {                $searchtext = $this->filterInput($_POST['txtsearch']);            }            $blogposts = $this->blogPostDatabase->getPostsByText($searchtext);            $this->view->setData('blogposts', $blogposts);        }        $this->view->setContentFile("views/posts/search.php");        $this->view->renderView();    }}?>