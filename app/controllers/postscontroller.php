<?phpnamespace app\controllers;use app\models\BlogPostDB;use app\models\BlogCommentDB;use app\models\BlogUserDB;use app\models\BlogPost;use app\models\BlogComment;use app\validators\FilterInputTrait;use app\validators\CommentValidator;class PostsController {    use FilterInputTrait;    protected $blogPostDatabase;    protected $blogUserDatabase;    protected $blogCommentDatabase;    protected $view;    protected $blogComment;    public function __construct(BlogUserDB $blogUserDatabase, BlogPostDB $blogPostDatabase, BlogCommentDB $blogCommentDatabase, View $view) {        $this->blogUserDatabase = $blogUserDatabase;        $this->blogPostDatabase = $blogPostDatabase;        $this->blogCommentDatabase = $blogCommentDatabase;        $this->view = $view;    }       public function index() {        $blogPostsList = $this->blogPostDatabase->getVisiblePosts();        foreach ($blogPostsList as $singleBlogPost) {            $blogUsersList[$singleBlogPost->postUserId] = $this->blogUserDatabase->getUserById($singleBlogPost->postUserId);        }        $this->view->setData("blogPostsList",$blogPostsList);        $this->view->setData("blogUsersList",$blogUsersList);                $this->view->setContentFile("views/posts/index.php");        $this->view->renderView();    }    public function show() {        if ($_SERVER['REQUEST_METHOD'] == 'POST') {            $result = $this->newcomment();            if (is_array($result)) {                $errorMessages = $result;                $this->view->setData("errorMessages",$errorMessages);                $this->view->setData('blogComment', $this->blogComment);            }        }        if (!isset($_GET['id'])) {            $this->error("No post id mentioned");            return;        }        $id = htmlspecialchars($_GET['id']);        $blogPost = $this->blogPostDatabase->getPost($id);        if (!$blogPost instanceof BlogPost) {            $this->error("Cannot find the post with id $id");            return;        }        $blogUser = $this->blogUserDatabase->getUserById($blogPost->postUserId);        $this->blogPostDatabase->updatePostRead($blogPost->postId);        $blogCommentsList = $this->blogCommentDatabase->getCommentsByPost($blogPost->postId);        $pageTitle = "Welcome to Articles By U --- $blogPost->postTitle";        $this->view->setData("pageTitle",$pageTitle);        $this->view->setData("blogPost",$blogPost);        $this->view->setData("blogUser",$blogUser);        $this->view->setData("blogCommentsList",$blogCommentsList);                $this->view->setContentFile("views/posts/show.php");        $this->view->renderView();         }    public function error($errorMessage) {        $this->view->setData("errorMessage",$errorMessage);        $this->view->setContentFile("views/posts/error.php");        $this->view->renderView();            }    public function newcomment() {                if (!($_SERVER['REQUEST_METHOD'] == 'POST')) {            return;        }        // so, the following lines get executed only, if the request method is post        $this->blogComment = new BlogComment();        $commentValidator = new CommentValidator;        $errorMessages = $commentValidator->validateCommentForm($_POST, $this->blogComment);        if(!empty($errorMessages)) {            return $errorMessages;                        }        $result = $this->blogCommentDatabase->addComment($this->blogComment);        return $result;            }    public function search() {        if ($_SERVER['REQUEST_METHOD'] == 'POST') {            $searchtext = '';            if (!empty($_POST['txtsearch'])) {                $searchtext = $this->filterInput($_POST['txtsearch']);                $this->view->setData('searchtext', $searchtext);            }            $blogposts = $this->blogPostDatabase->getPostsByText($searchtext);            $this->view->setData('blogposts', $blogposts);        }        $this->view->setContentFile("views/posts/search.php");        $this->view->renderView();    }}?>